## Half-gate AND

We can split AND gate into two parts:

$$
\begin{aligned}
c &= a \land b \\
&= (a \land r) \oplus (a \land (b \oplus r)) \\
\end{aligned}
$$
where $r$ is a random secret bit generated by garbler before garbling, and $b \oplus r$ is encoded bit value of $b$, it is sent to evaluator. In this case, $r$ is only known by garbler, while $b' = b \oplus r$ is known by evaluator.

Since have free-xor gate $\oplus$, we can split an AND gate into two half-and gates.

## Generator Half-gate

$$
c_G = a \land r
$$

For illustration, we assume that the permutation bit of wire $W_A$ is $p_A = LBS(W_A^0) = 1$, in this case the select bit for 0-label is $s_A^0 = LBS(W_A^0) = 1$, and the select bit for 1-label is $s_A^1 = LBS(W_A^1) = 0$. 

> Note that, *select bit* is the position indice of garbling entry.

-----

Regarding the case $r = 0$, the result $c_G$ is $0$ whatever $a$ is. 

#### Before GRR

**Garbling**

Two ciphertexts for garbler:
$$
e_0 = H(W_A^0) \oplus W_{C_G}^0 \\
e_1 = H(W_A^1) \oplus W_{C_G}^0 \\
$$
Garbler has to send these two different ciphertexts to evaluator, note that before sending the order of ciphertexts needs to be permutated according to the permutation bit of wire $W_A$. Because $p_A = 1$, we have:
$$
T = [e1, e0]
$$ 

Observing that $2$ hashes and $2$ XOR operations involved when garbling.

**Evaluating**

Garbler reveals a key of wire $W_A$ to evaluator, say $K = W_A^a$. 

- If $a = 0$, then evaluator will get its select bit $s_A^a = LBS(W_A^a) = 1$. Then decrypt corresponding ciphertext:
    $$
    Decrpt(T[s_A^a], H(W_A^a)) = Decrpt(T[1], H(W_A^0)) = W_{C_G}^0
    $$
    will get $W_{C_G}^0$ finally.

- If $a = 1$, then its select bit $s_A^a = 0$, Then decrpt corresponding ciphertext:
    $$
    Decrpt(T[s_A^a], H(W_A^a)) = Decrpt(T[0], H(W_A^1)) = W_{C_G}^0
    $$

#### After GRR

**Garbling**

One ciphertext for garbler:

Garbler needs to eliminate the first ciphertext before sending garbled table $T$, i.e. under the condition $p_A = 1$, $T[0] = e_1$ needs to be removed. The simplest way is to make $e_1 = 0$, in this case the output labels can not be arbitrary anymore:

$$
W_{C_G}^0 = H(W_A^1)
$$

So there is only one ciphertext in the updated garbled table $T = [e_0]$, we assume $T[-1] = \mathbb{O}$.

**Evaluating**

Garbler reveals a key of wire $W_A$ to evaluator, say $K = W_A^a$:
- If $a = 0$, its select bit is $s_A^0 = 1$, then decypt:
  $$
    Decrypt(T[s_A^a - 1], H(W_A^a)) = Decypt(T[0], W_A^0) = W_{C_G}^0 = H(W_A^1)
  $$
- If $a = 1$, its select bit is $s_A^1 = 0$, then decypt:
  $$
    Decrypt(T[s_A^a - 1], H(W_A^a)) = Decypt(T[-1], W_A^1) = W_{C_G}^0 = H(W_A^1)
  $$

------

Regarding the case $r = 1$, the result variants depends on $a$.

#### Before GRR

**Garbling**

Two ciphertexts needed:
$$
\begin{aligned}
e_0 &= H(W_A^0) \oplus W_{C_G}^0 \\
e_1 &= H(W_A^1) \oplus (W_{C_G}^0 \oplus R) = H(W_A^1) \oplus W_{C_G}^1 \\
\end{aligned}
$$

After permutated (still assuming $p_A = 1$) the garbling table would be $T = [e_1, e_0]$.

**Evaluating**

Garbler evaluate input label $W_A^a$:
- if $a = 0$, its select bit is $s_A^0 = 1$, then decrpt:
  $$
    Decrpt(T[s_A^a], H(W_A^a)) = Decrpt(T[1], H(W_A^0)) = W_{C_G}^0
  $$
- if $a = 1$, its select bit is $s_A^1 = 0$, then decrpt:
  $$
    Decrpt(T[s_A^a], H(W_A^a)) = Decrpt(T[0], H(W_A^1)) = W_{C_G}^1
  $$

#### After GRR

**Garbling**

Since the permutation bit is $p_A = 1$, we need to eliminate the first ciphertext $T[0] = e_1$, in this case:
$$
W_{C_G}^0 = H(W_A^1) \oplus R
$$
The updated garbling table would be like $T = [e_0]$, we assume $T[-1] = \mathbb{O}$.

**Evaluating**

Garbler evaluate input label $W_A^a$:
- if $a = 0$, its select bit is $s_A^0 = 1$, then decrpt: 
    $$
        Decrpt(T[s_A^a - 1], H(W_A^a)) = Decrpt(T[0], H(W_A^0)) = W_{C_G}^0 = H(W_A^1) \oplus R 
    $$
- if $a = 1$, its select bit is $s_A^1 = 0$, then decrpt:
    $$
       Decrpt(T[s_A^a - 1], H(W_A^a)) = Decrypt(T[-1], H(W_A^1)) = W_{C_G}^1 = H(W_A^1) 
    $$

----

In conclusion: one garbling side, two hashes are needed; on evaluating side, one hash is needed. After **GRR**, only one ciphertext is need to be transmitted.

## Evaluator Half-gate

$$
c_E = a \land (b \oplus r) = a \land b'
$$